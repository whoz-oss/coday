<!-- Floating Action Button -->
<button 
  class="floating-menu-btn"
  (click)="toggleMenu()"
  [class.active]="isMenuOpen"
  title="Menu Coday"
>
  <img src="CODAY-Logo.png" alt="Coday" class="logo" />
  <div class="hamburger-overlay">‚ò∞</div>
</button>

<!-- Menu dropdown -->
<div 
  *ngIf="isMenuOpen" 
  class="floating-menu"
  (click)="$event.stopPropagation()"
  (keydown)="$event.stopPropagation()"
  tabindex="-1"
  role="menu"
  aria-label="Menu principal de Coday"
>
  <!-- Project selector - moved to top -->
  <div class="menu-section project-selector-section">
    <app-project-selector class="main-project-selector"></app-project-selector>
  </div>
  
  <!-- Navigation -->
  <div class="menu-section navigation">
    <!-- Thread selector - now functional -->
    <app-thread-selector class="main-thread-selector"></app-thread-selector>
  </div>
  
  <!-- Settings -->
  <div class="menu-section">
    <!-- User Config - always visible -->
    <div class="menu-item-wrapper">
      <button class="menu-button" (click)="openUserConfig()">
        <span class="menu-icon">üë§</span>
        <span class="menu-text">User Config</span>
      </button>
    </div>
    
    <!-- Project Config - only for CODAY_ADMIN -->
    <div class="menu-item-wrapper" *ngIf="isAdmin">
      <button class="menu-button" 
              (click)="openProjectConfig()"
              [disabled]="!hasProject()"
              [class.disabled]="!hasProject()"
              [title]="hasProject() ? 'Edit project configuration' : 'No project selected'">
        <span class="menu-icon">üìÅ</span>
        <span class="menu-text">Project Config</span>
        <span class="disabled-hint" *ngIf="!hasProject()">(No project)</span>
      </button>
    </div>
    
    <div class="menu-item-wrapper">
      <span class="menu-text">Theme</span>
      <app-theme-selector class="inline-selector"></app-theme-selector>
    </div>
    
    <div class="menu-item-wrapper">
      <span class="menu-text">Preferences</span>
      <app-options-panel class="inline-panel"></app-options-panel>
    </div>
  </div>
</div>

<!-- JSON Editor Modals -->
<app-json-editor 
  [configType]="'user'"
  [isOpen]="isUserConfigOpen"
  [initialContent]="userConfigJson"
  [isLoading]="isLoadingUserConfig"
  [isSaving]="isSavingUserConfig"
  (save)="onUserConfigSave($event)"
  (closeEditor)="onUserConfigCancel()"
></app-json-editor>

<app-json-editor 
  *ngIf="hasProject()"
  [configType]="'project'" 
  [projectName]="getCurrentProjectName()!"
  [isOpen]="isProjectConfigOpen"
  [initialContent]="projectConfigJson"
  [isLoading]="isLoadingProjectConfig"
  [isSaving]="isSavingProjectConfig"
  (save)="onProjectConfigSave($event)"
  (closeEditor)="onProjectConfigCancel()"
></app-json-editor>

<!-- Backdrop pour fermer le menu -->
<div 
  *ngIf="isMenuOpen" 
  class="menu-backdrop"
  (click)="closeMenu()"
  (keydown.escape)="closeMenu()"
  tabindex="-1"
  role="button"
  aria-label="Fermer le menu (cliquez ou appuyez sur √âchap)"
></div>