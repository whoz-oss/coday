<div class="message" [ngClass]="messageClasses">
  <!-- Layout normal pour user et assistant -->
  <ng-container *ngIf="!isSimplified">
    <!-- En-tête avec speaker -->
    <div class="message-header">
      <div class="speaker" *ngIf="shouldShowSpeaker">
        {{ message.speaker }}
      </div>
    </div>
    
    <!-- Menu contextuel en haut à droite -->
    <app-message-context-menu 
      *ngIf="shouldShowActions"
      [actions]="topActions" 
      position="top"
      class="context-menu-top">
    </app-message-context-menu>
    
    <!-- Contenu -->
    <div class="content markdown-content" [innerHTML]="renderedContent"></div>
    
    <!-- Menu contextuel en bas à droite pour les longs messages -->
    <app-message-context-menu 
      *ngIf="isLongMessage && shouldShowActions"
      [actions]="bottomActions" 
      position="bottom"
      class="context-menu-bottom">
    </app-message-context-menu>
  </ng-container>
  
  <!-- Layout simplifié pour les autres types -->
  <ng-container *ngIf="isSimplified">
    <div class="simple-content markdown-content">
      <span [innerHTML]="renderedContent"></span>
      <a *ngIf="eventLink" [href]="eventLink" target="_blank" class="event-link">view</a>
    </div>
  </ng-container>
</div>
