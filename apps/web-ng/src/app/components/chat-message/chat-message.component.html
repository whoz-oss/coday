<div class="message" 
     [ngClass]="messageClasses" 
     (click)="onMessageClick()" 
     (keydown.enter)="onMessageClick()" 
     (keydown.space)="onMessageClick()" 
     tabindex="0" 
     role="button" 
     [attr.aria-label]="'Message from ' + message.speaker + '. Click to stop speech if playing.'">
  <!-- Layout normal pour user et assistant -->
  <ng-container *ngIf="!isSimplified">
    <!-- En-tête avec speaker et actions -->
    <div class="message-header">
      <div class="speaker" *ngIf="shouldShowSpeaker">
        {{ message.speaker }}
      </div>
      
      <div class="actions" *ngIf="shouldShowActions">
        <button 
          class="action-btn play-btn" 
          [class.playing]="isPlaying"
          (click)="onPlay(); $event.stopPropagation()"
          [title]="isPlaying ? 'Stop playback' : 'Play message'"
        >
          {{ isPlaying ? '⏸️' : '▶️' }}
        </button>
        
        <button 
          class="action-btn" 
          (click)="onCopy(); $event.stopPropagation()"
          title="Copy message"
        >
          📋
        </button>
      </div>
    </div>
    
    <!-- Contenu -->
    <div class="content markdown-content" [innerHTML]="renderedContent"></div>
  </ng-container>
  
  <!-- Layout simplifié pour les autres types -->
  <ng-container *ngIf="isSimplified">
    <div class="simple-content markdown-content">
      <span [innerHTML]="renderedContent"></span>
      <a *ngIf="eventLink" [href]="eventLink" target="_blank" class="event-link" (click)="$event.stopPropagation()">view</a>
    </div>
  </ng-container>
</div>