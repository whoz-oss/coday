<div class="options-container">
  <!-- Button to open/close the panel -->
  <button 
    class="options-toggle-btn"
    (click)="togglePanel()"
    [class.active]="isVisible"
    title="Options"
    type="button"
  >
    ‚öôÔ∏è
  </button>
  
  <!-- Backdrop to close the panel by clicking outside -->
  <div 
    *ngIf="isVisible"
    class="options-backdrop"
    (click)="onBackdropClick()"
    (keydown.escape)="closePanel()"
    tabindex="-1"
    role="button"
    aria-label="Close options (click or press Escape)"
  ></div>
  
  <!-- Options panel -->
  <div 
    *ngIf="isVisible"
    #optionsPanel
    class="options-panel"
    (click)="onPanelClick($event)"
    (keydown)="onPanelClick($event)"
    role="dialog"
    aria-label="Configuration options panel"
  >
    <div class="options-header">
      <h3>Options</h3>
      <button 
        class="close-btn"
        (click)="closePanel()"
        title="Fermer"
        type="button"
      >
        ‚úï
      </button>
    </div>
    
    <div class="options-content">
      <!-- Enter key behavior -->
      <div class="option-group">
        <label class="option-checkbox">
          <input 
            type="checkbox"
            [(ngModel)]="useEnterToSend"
            (change)="onEnterToSendChange()"
          />
          <span class="checkmark"></span>
          Use Enter to send (Shift+Enter for new line)
        </label>
      </div>
      
      <!-- Print technical messages -->
      <div class="option-group"}
        <label class="option-checkbox">
          <input 
            type="checkbox"
            [(ngModel)]="printTechnicalMessages"
            (change)="onPrintTechnicalMessagesChange()"
          />
          <span class="checkmark"></span>
          Include technical messages in print
        </label>
      </div>
      
      <!-- Voice language selection -->
      <div class="option-group">
        <label for="voice-language-select" class="option-label">
          Voice recognition language:
        </label>
        <select 
          id="voice-language-select"
          class="option-select"
          [(ngModel)]="selectedVoiceLanguage"
          (change)="onVoiceLanguageChange()"
        >
          <option 
            *ngFor="let option of voiceLanguageOptions" 
            [value]="option.code"
          >
            {{ option.flag }} {{ option.label }}
          </option>
        </select>
      </div>
      
      <!-- Voice synthesis section -->
      <div class="option-section">
        <h4 class="section-title">üîä Voice synthesis</h4>
        
        <!-- Automatic announcement -->
        <div class="option-group">
          <label class="option-checkbox">
            <input 
              type="checkbox"
              [(ngModel)]="voiceAnnounceEnabled"
              (change)="onVoiceAnnounceEnabledChange()"
            />
            <span class="checkmark"></span>
            Automatic announcement of responses
          </label>
        </div>
        
        <!-- Voice mode -->
        <div class="option-group">
          <span class="option-label">Voice mode:</span>
          <div class="radio-group">
            <label class="option-radio">
              <input 
                type="radio" 
                name="voiceMode" 
                value="speech"
                [(ngModel)]="voiceMode"
                (change)="onVoiceModeChange()"
              />
              <span class="radio-mark"></span>
              üó£Ô∏è Voice synthesis
            </label>
            <label class="option-radio">
              <input 
                type="radio" 
                name="voiceMode" 
                value="notification"
                [(ngModel)]="voiceMode"
                (change)="onVoiceModeChange()"
              />
              <span class="radio-mark"></span>
              üîî Sound notification
            </label>
          </div>
        </div>
        
        <!-- Full reading -->
        <div class="option-group">
          <label class="option-checkbox">
            <input 
              type="checkbox"
              [(ngModel)]="voiceReadFullText"
              (change)="onVoiceReadFullTextChange()"
            />
            <span class="checkmark"></span>
            Full message reading (otherwise first paragraphs)
          </label>
        </div>
        
        <!-- Voice selection -->
        <div class="option-group">
          <label for="voice-select" class="option-label">
            Selected voice:
          </label>
          <select 
            id="voice-select"
            class="option-select"
            [(ngModel)]="selectedVoiceId"
            (change)="onSelectedVoiceChange()"
            [disabled]="loadingVoices || availableVoices.length === 0"
          >
            <option value="" *ngIf="loadingVoices">üîÑ Loading voices...</option>
            <option value="" *ngIf="!loadingVoices && availableVoices.length === 0">‚ö†Ô∏è No voice available</option>
            <option 
              *ngFor="let voice of availableVoices" 
              [value]="voice.name + '|' + voice.lang"
            >
              {{ voice.displayName }}
            </option>
          </select>
        </div>
        
        <!-- Volume -->
        <div class="option-group">
          <label for="voice-volume-slider" class="option-label">
            Volume: {{ voiceVolume }}%
          </label>
          <input 
            id="voice-volume-slider"
            type="range" 
            min="0" 
            max="100" 
            step="5"
            class="option-slider"
            [(ngModel)]="voiceVolume"
            (input)="onVoiceVolumeChange()"
          />
        </div>
        
        <!-- Speed -->
        <div class="option-group">
          <label for="voice-rate-slider" class="option-label">
            Speed: {{ voiceRate }}%
          </label>
          <input 
            id="voice-rate-slider"
            type="range" 
            min="50" 
            max="200" 
            step="10"
            class="option-slider"
            [(ngModel)]="voiceRate"
            (input)="onVoiceRateChange()"
          />
        </div>
        
        <!-- Voice test -->
        <div class="option-group">
          <button 
            type="button" 
            class="test-voice-btn"
            (click)="testVoice()"
            title="Test voice with current settings"
          >
            üîä Test voice
          </button>
        </div>
      </div>
    </div>
  </div>
</div>