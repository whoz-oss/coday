<div
  class="project-selector"
  (click)="$event.stopPropagation()"
  (keydown)="$event.stopPropagation()"
  tabindex="0"
  role="application"
  aria-label="Sélecteur de projet"
>
  <!-- Main selector button -->
  <button
    class="selector-button"
    [class.clickable]="isClickable()"
    [class.expanded]="isExpanded"
    [disabled]="!isClickable()"
    (click)="toggleDropdown()"
    type="button"
  >
    <span class="selector-icon">{{ getIcon() }}</span>
    <span class="selector-text">{{ getDisplayText() }}</span>
  </button>

  <!-- Dropdown menu -->
  @if (isExpanded && canShowDropdown()) {
    <div class="dropdown-menu" role="menu" aria-label="Sélection de projet">
      @for (project of getAvailableProjects(); track project.name) {
        <button
          class="dropdown-item"
          [class.current]="project.name === projects?.current"
          (click)="selectProject(project.name)"
          type="button"
          role="menuitem"
        >
          <span class="project-name">{{ project.name }}</span>
          @if (project.name === projects?.current) {
            <span class="current-indicator">✓</span>
          }
        </button>
      }

      @if (getAvailableProjects().length === 0) {
        <div class="dropdown-empty">Aucun projet disponible</div>
      }
    </div>
  }
</div>

<!-- Backdrop to close dropdown -->
@if (isExpanded) {
  <div
    class="dropdown-backdrop"
    (click)="closeDropdown()"
    (keydown.escape)="closeDropdown()"
    tabindex="0"
    role="button"
    aria-label="Fermer le menu de sélection"
  ></div>
}
