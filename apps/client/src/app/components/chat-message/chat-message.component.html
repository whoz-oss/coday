<div class="message-wrapper" [ngClass]="{ 'user-message-wrapper': message.role === 'user' }">
  <div class="message" [ngClass]="messageClasses">
    <!-- Normal layout for user and assistant messages -->
    @if (!isSimplified) {
      <!-- Header with speaker -->
      @if (shouldShowSpeaker) {
        <div class="message-header">
          <div class="speaker">
            {{ message.speaker }}
          </div>
        </div>
      }

      <!-- Content -->
      <div class="content markdown-content" [innerHTML]="renderedContent"></div>

      <!-- Context menu for assistant messages (inside bubble) when long message -->
      @if (isLongMessage && shouldShowActions && message.role === 'assistant') {
        <div class="actions bottom-actions">
          <app-message-context-menu [actions]="actions"> </app-message-context-menu>
        </div>
      }
    }

    <!-- Simplified layout for other message types -->
    @if (isSimplified) {
      <div class="simple-content markdown-content">
        <span [innerHTML]="renderedContent"></span>
        @if (eventLink) {
          <a [href]="eventLink" target="_blank" class="event-link">view</a>
        }
      </div>
    }
  </div>

  <!-- Context menu for assistant messages (right of bubble) -->
  @if (!isLongMessage && shouldShowActions && message.role === 'assistant') {
    <div class="actions assistant-top-actions">
      <app-message-context-menu [actions]="actions"> </app-message-context-menu>
    </div>
  }

  <!-- Context menu for user messages (always left of bubble) -->
  @if (shouldShowActions && message.role === 'user') {
    <div class="actions user-top-actions">
      <app-message-context-menu [actions]="actions"> </app-message-context-menu>
    </div>
  }
</div>
