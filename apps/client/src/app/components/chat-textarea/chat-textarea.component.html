<div class="chat-input-container">
  <div *ngIf="isRecording" class="recording-indicator">
    <span class="recording-dot"></span>
    Recording... Release to stop
  </div>
  <!-- Input row: textarea + voice + send, all inside rounded box -->
  <div class="input-row grouped-input" [class.focused]="isFocused">
    <textarea
      #messageInput
      class="message-input"
      [(ngModel)]="message"
      placeholder="How can I help you today?"
      (keydown)="onKeyDown($event)"
      (input)="onInput()"
      [disabled]="isDisabled"
      (focus)="isFocused = true"
      (blur)="isFocused = false"
    ></textarea>
    <button
      class="voice-btn"
      [class.recording]="isRecording"
      [class.hidden]="message.trim()"
      (mousedown)="onVoiceButtonMouseDown($event)"
      (mouseup)="onVoiceButtonMouseUp()"
      (mouseleave)="onVoiceButtonMouseLeave()"
      (touchstart)="onVoiceButtonTouchStart($event)"
      (touchend)="onVoiceButtonTouchEnd($event)"
      (keydown)="onVoiceButtonKeyDown($event)"
      (keyup)="onVoiceButtonKeyUp($event)"
      tabindex="0"
      title="Maintenir clic souris, touch, ou barre espace pour parler"
    >
      <span class="material-icons voice-icon">{{ isRecording ? 'fiber_manual_record' : 'mic' }}</span>
    </button>
    <button
      class="send-btn"
      (click)="sendMessage()"
      [disabled]="isDisabled || !message.trim()"
      [class.hidden]="isDisabled || !message.trim()"
      [class.active]="!!message.trim() && !isDisabled"
      [title]="getSendButtonTooltip()"
      type="button"
    >
      <span class="material-icons send-icon">send</span>
    </button>
  </div>
</div>
