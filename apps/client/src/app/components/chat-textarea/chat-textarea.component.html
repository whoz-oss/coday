<div class="chat-input-container">
  @if (isRecording) {
    <div class="recording-indicator">
      <span class="recording-dot"></span>
      Recording... Release to stop
    </div>
  }
  <!-- Input row: textarea + voice + send, all inside rounded box -->
  <div class="input-row grouped-input" [class.focused]="isFocused" [class.welcome-mode]="showWelcome">
    <textarea
      #messageInput
      class="message-input"
      [(ngModel)]="message"
      [placeholder]="showWelcome ? 'How can I help you today?' : 'Type your prompt here'"
      (keydown)="onKeyDown($event)"
      (input)="onInput()"
      [disabled]="isDisabled"
      (focus)="isFocused = true"
      (blur)="isFocused = false"
    ></textarea>
    <button
      class="voice-btn"
      mat-icon-button
      [class.recording]="isRecording"
      [class.hidden]="message.trim()"
      (mousedown)="onVoiceButtonMouseDown($event)"
      (mouseup)="onVoiceButtonMouseUp()"
      (mouseleave)="onVoiceButtonMouseLeave()"
      (touchstart)="onVoiceButtonTouchStart($event)"
      (touchend)="onVoiceButtonTouchEnd($event)"
      (keydown)="onVoiceButtonKeyDown($event)"
      (keyup)="onVoiceButtonKeyUp($event)"
      tabindex="0"
      title="Hold mouse click, touch, or spacebar to speak"
    >
      <mat-icon>{{ isRecording ? 'fiber_manual_record' : 'mic' }}</mat-icon>
    </button>
    <button
      class="send-btn"
      mat-icon-button
      (click)="sendMessage()"
      [disabled]="isDisabled || !message.trim()"
      [class.hidden]="isDisabled || !message.trim()"
      [class.active]="!!message.trim() && !isDisabled"
      [title]="getSendButtonTooltip()"
      type="button"
    >
      <mat-icon>send</mat-icon>
    </button>
  </div>
</div>
