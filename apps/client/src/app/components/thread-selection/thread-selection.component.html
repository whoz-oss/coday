<div class="thread-selection-container">
  <!-- Header with project name -->
  <div class="header">
    <div class="project-info">
      <span class="back-link" (click)="router.navigate(['/'])" title="Back to projects"> ‚Üê </span>
      <h1>{{ projectName }}</h1>
    </div>
    <p>Select a thread or start a new conversation</p>
  </div>

  <!-- New thread section with textarea -->
  <div class="new-thread-section">
    <div class="new-thread-card">
      <h2>Start a new thread</h2>
      <textarea
        #messageInput
        [(ngModel)]="firstMessage"
        (keydown)="onKeyDown($event)"
        placeholder="Type your first message here... (Cmd+Enter or Ctrl+Enter to send)"
        rows="4"
        [disabled]="isCreatingThread"
        class="message-textarea"
      ></textarea>
      <div class="new-thread-actions">
        <button
          (click)="createThreadWithMessage()"
          [disabled]="!firstMessage.trim() || isCreatingThread"
          class="create-button"
        >
          @if (!isCreatingThread) {
          <span>Create & Send</span>
          }
          @if (isCreatingThread) {
          <span>Creating...</span>
          }
        </button>
        <span class="hint">Cmd+Enter or Ctrl+Enter</span>
      </div>
    </div>
  </div>

  <!-- Error state -->
  @if (error) {
  <div class="error">
    <p>{{ error }}</p>
    <button (click)="retry()" class="retry-button">Retry</button>
  </div>
  }

  <!-- Existing threads section -->
  <div class="threads-section">
    <h2>Recent threads</h2>

    <!-- Loading state -->
    @if (isLoadingThreads) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading threads...</p>
    </div>
    }

    <!-- Thread list -->
    @if (!isLoadingThreads && threads.length > 0) {
    <div class="thread-list">
      @for (thread of threads; track trackByThreadId($index, thread)) {
      <div
        class="thread-item"
        (click)="selectThread(thread.id)"
        tabindex="0"
        (keydown.enter)="selectThread(thread.id)"
        (keydown.space)="selectThread(thread.id)"
      >
        <div class="thread-icon">üí¨</div>
        <div class="thread-info">
          <div class="thread-name">{{ thread.name || 'Untitled' }}</div>
          <div class="thread-date">{{ formatDate(thread.modifiedDate) }}</div>
        </div>
      </div>
      }
    </div>
    }

    <!-- No threads state -->
    @if (!isLoadingThreads && threads.length === 0 && !error) {
    <div class="no-threads">
      <p>No threads yet for this project.</p>
      <p class="hint">Start a new conversation above to create your first thread.</p>
    </div>
    }
  </div>
</div>
