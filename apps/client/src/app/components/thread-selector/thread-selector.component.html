<div
  class="thread-selector"
  (click)="$event.stopPropagation()"
  (keydown)="$event.stopPropagation()"
  tabindex="0"
  role="application"
  aria-label="Thread selector"
>
  <!-- Thread list (always visible in sidenav) -->
  @if (canShowDropdown()) {
    <div class="thread-list" role="menu" aria-label="Thread selection">
      <!-- New thread option (always first) -->
      <button class="thread-item new-thread-item" (click)="createNewThread()" type="button" role="menuitem">
        <mat-icon fontSet="material-icons-outlined">edit_square</mat-icon>
        <span class="thread-name">New thread</span>
      </button>

      <!-- Existing threads -->
      @for (thread of getAvailableThreads(); track thread.id) {
        <button
          class="thread-item"
          [class.current]="thread.id === threads?.current"
          [title]="thread.name"
          (click)="selectThread(thread.id)"
          type="button"
          role="menuitem"
        >
          <span class="thread-name">{{ thread.name }}</span>
          <span class="thread-date">{{ formatDate(thread.modifiedDate) }}</span>
        </button>
      }

      @if (!hasThreadsAvailable()) {
        <div class="thread-empty">No existing threads</div>
      }
    </div>
  } @else {
    <div class="thread-disabled">
      @if (!hasProjectSelected()) {
        <span class="disabled-text">No project selected</span>
      } @else {
        <span class="disabled-text">Loading...</span>
      }
    </div>
  }
</div>
