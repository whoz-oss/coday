<div
  class="thread-selector"
  (click)="$event.stopPropagation()"
  (keydown)="$event.stopPropagation()"
  tabindex="0"
  role="application"
  aria-label="Thread selector"
>
  <!-- Thread list (always visible in sidenav) -->
  @if (currentProject()?.name) {
    <div class="thread-list" role="menu" aria-label="Thread selection">
      <!-- Grouped threads -->
      @for (group of getGroupedThreads(); track group.label) {
        <div class="thread-group">
          <div class="thread-group-header">{{ group.label }}</div>
          @for (thread of group.threads; track thread.id) {
            <button
              class="thread-item"
              [class.current]="thread.id === currentThread()?.id"
              [title]="thread.name"
              (click)="selectThread(thread.id)"
              type="button"
              role="menuitem"
            >
              <span class="thread-name">{{ thread.name }}</span>
            </button>
          }
        </div>
      }

      @if (!threads()?.length) {
        <div class="thread-empty">No existing threads</div>
      }
    </div>
  } @else {
    <div class="thread-disabled">
      @if (!currentProject()?.name) {
        <span class="disabled-text">No project selected</span>
      } @else {
        <span class="disabled-text">Loading...</span>
      }
    </div>
  }
</div>
