<div
  class="thread-selector"
  (click)="$event.stopPropagation()"
  (keydown)="$event.stopPropagation()"
  tabindex="0"
  role="application"
  aria-label="Thread selector"
>
  <!-- Thread list (always visible in sidenav) -->
  @if (currentProject()?.name) {
    <div class="thread-list" role="menu" aria-label="Thread selection">
      <!-- Loading state -->
      @if (isLoadingThreadList()) {
        <div class="thread-loading">
          <span class="loading-spinner"></span>
          <span class="loading-text">Loading threads...</span>
        </div>
      } @else {
        <!-- Grouped threads -->
        @for (group of getGroupedThreads(); track group.label) {
          <div class="thread-group">
            <div class="thread-group-header">{{ group.label }}</div>
            @for (thread of group.threads; track thread.id) {
              <button
                class="thread-item"
                [class.current]="thread.id === currentThread()?.id"
                [title]="thread.name || 'Generating name...'"
                (click)="selectThread(thread.id)"
                type="button"
                role="menuitem"
              >
                @if (thread.name) {
                  <span class="thread-name">{{ thread.name }}</span>
                } @else {
                  <mat-spinner class="thread-name-spinner" [diameter]="16"></mat-spinner>
                  <span class="thread-name thread-name-generating">Generating name...</span>
                }
              </button>
            }
          </div>
        }

        <!-- Empty states -->
        @if (!threads()?.length && !searchQuery) {
          <div class="thread-empty">No existing threads</div>
        } @else if (searchQuery && getGroupedThreads().length === 0) {
          <div class="thread-empty">No threads matching "{{ searchQuery }}"</div>
        }
      }
    </div>
  } @else {
    <div class="thread-disabled">
      @if (!currentProject()?.name) {
        <span class="disabled-text">No project selected</span>
      } @else {
        <span class="disabled-text">Loading...</span>
      }
    </div>
  }
</div>
